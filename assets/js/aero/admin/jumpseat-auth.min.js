"use strict";Aero.view.admin={guideid:"",type:"",render:function(b,a){$q(".container-close").remove();this.type=b;if(Aero.tip._guide){Aero.tip.hide()}$q(".aero-active").removeClass("aero-active");Aero.tpl.get("sidebar-"+this.type+"-admin.html",function(e){$q(".aero-admin-wrapper").remove();var d=_q.template(e);$q("body").append(d({model:a}));$q("#aero-tab").css("left","-542px");$q(".aero-sidebar").prepend('<div class="aero-blanket" style="display:none"></div>');$q(".aero-blanket").fadeTo(300,0.9,function(){});if(b=="step"){$q(".aero-nav-item:not(:first)").append('<a class="aero-del-nav">X</a>')}var c=$q.trumbowyg.btnsGrps;$q("#aeroEditor").trumbowyg({fullscreenable:false,fixedFullWidth:true,resetCss:true,autogrow:true,btns:["viewHTML","|",c.design,"|","link","|","insertImage","|",c.justify,"|",c.lists,"|","insertHorizontalRule"]})});setTimeout("$q('.aero-required:eq(0)').focus();",300)},renderMenu:function(b){var a=$q(".aero-strip-menu li").index(b);$q(".aero-admin-body .open").removeClass("open");$q(".aero-strip-menu li").removeClass("aero-menu-active");b.addClass("aero-menu-active");$q("#aeroSection"+a).addClass("open");if(a==2&&this.type=="guide"){Aero.view.guide.admin.renderRoles()}if(a==1&&this.type=="guide"){Aero.view.guide.admin.renderPathways()}},renderMenuTip:function(a,d){var c=$q('<div class="aero-menu-tip" style="top:-200px"><span></span>'+d+"</div>");var b=a.offset().top+(c.outerHeight()/2)+16;$q(".aero-app").append(c);c.css({top:b-$q(window).scrollTop(),left:55,opacity:0});c.animate({opacity:1,left:"+=8"},100)},close:function(){var a=($q(".aero-editing-step").hasClass("aero-add-step")?false:true);$q(".aero-admin-wrapper, .aero-edit-active").remove();$q("#aero-tab").css("left","-44px");$q(".aero-blanket").fadeTo("medium",0,function(){$q(this).remove()});$q(".aero-editing").removeClass("aero-editing");if(Aero.tip._guide&&a){var b=Aero.step.get(Aero.tip._current);Aero.tip.beforeShow(Aero.tip._current,b)}},edit:function(c){var a=this;var d=c.parents("li:eq(0)");var b=Aero.tip._guide?"step":"guide";a.guideid=Aero.tip._guide?Aero.tip._guide.id:c.parents("li:eq(0)").data("guideid");d.addClass("aero-editing");d.prepend('<span class="aero-edit-active"></span>');Aero.guide.get(a.guideid,function(e){if(b=="step"){e=e.step[Aero.index];e.id=a.guideid;e.index=Aero.index;e.isAdd=false}Aero.view.admin.render(b,e)})},renderTools:function(b){var d=b.find(".aero-item-tools:eq(0)");if(d.length>0){d.show();return}var c=b.data("guideid")?"guide":"step";var a=b.data("guideid")||Aero.tip._guide.id;Aero.tpl.get("sidebar-"+c+"-tools.html",function(e){Aero.model.guide.byId(a,function(f){var g=_q.template(e);b.prepend(g({creator:(f.creator==Aero.constants.USERNAME)}))})})},setEvents:function(b){var a=this;if(b){a.type=b}$q("body").off("click.aeroCancel").on("click.aeroCancel",".aero-cancel-edit",function(){a.close();return false}).off("mouseenter.aerome").on("mouseenter.aerome",".aero-strip-menu a",function(){$q(".aero-menu-tip").remove();Aero.view.admin.renderMenuTip($q(this),$q(this).data("title"))}).off("mouseleave.aeroml").on("mouseleave.aeroml",".aero-strip-menu a",function(){$q(".aero-menu-tip").remove()}).off("click.aeroTools").on("mouseenter.aeroTools",".aero-"+a.type+"s ul li",function(){Aero.view.admin.renderTools($q(this));return false}).off("click.aeroTools").on("mouseleave.aeroTools",".aero-"+a.type+"s ul li",function(){$q(".aero-item-tools").hide()}).off("change.aerob").on("change.aerob","select[name='aero_branch']",function(){$q('select[name="aero_return"]').parents("div:eq(0)").hide();if($q(this).val()!=""){$q('select[name="aero_return"]').parents("div:eq(0)").show()}})}};"use strict";Aero.view.guide.admin={id:"",renderRoles:function(){this.renderMapping("roles")},renderPathways:function(){this.renderMapping("pathways")},renderMapping:function(a){Aero[a].getAll(function(b){$q(".aero-"+a).html("").append('<option value="">- Select a '+a.slice(0,-1)+" -</option>");for(var c in b){if(b.hasOwnProperty(c)){$q(".aero-"+a).append('<option value="'+b[c].id+'">'+b[c].title+"</option>")}}});Aero[a].getByGuideid(Aero.view.admin.guideid,function(b){$q(".aero-"+a+"-list ul").html("");for(var c in b){if(b.hasOwnProperty(c)){$q(".aero-"+a+"-list ul").append('<li class="clearfix" data-id="'+b[c].id+'"><a class="aero-btn-grey"><i class="fa fa-times"></i></a><span>'+b[c].title+"</span></li>")}}})},save:function(){var b=Aero.view.admin.guideid;var a=$q("#editGuideFrm").aeroSerialize();a.desc=$q("#aeroEditor").trumbowyg("html");Aero.view.admin.close();a.active=(a.active=="1");a.auto=(a.auto=="1")?true:null;a.autoPage=(a.autoPage=="1")?true:null;if(b!=""){a.id=b;Aero.guide.update(a)}else{Aero.guide.create(a,function(c){Aero.tip.start(c)})}},setEvents:function(a){var b=this;$q("body").off("click.aeroGCreate").on("click.aeroGCreate","a.aero-btn-create",function(){Aero.view.admin.guideid="";Aero.view.admin.render("guide",{});return false});$q("body").off("click.aeroSMenu").on("click.aeroSMenu",".aero-strip-menu a",function(){var c=$q(this).parents("li:eq(0)");Aero.view.admin.renderMenu(c);return false});$q("body").off("click.aeroGDelete").on("click.aeroGDelete",".aero-guides ul li a.aero-delete",function(){var c=$q(this).parents("li:eq(0)");var e=c.data("guideid");var d=c.find("a:last").text();Aero.confirm({ok:"Delete",title:d,msg:"Are you sure you want to delete this guide?",onConfirm:function(){Aero.guide.destroy(e)}});return false});$q("body").off("click.aeroGEdit").on("click.aeroGEdit",".aero-guides ul li a.aero-edit",function(){Aero.view.admin.edit($q(this));return false});$q("body").off("keypress.gsa").on("keypress.gsa","#editGuideFrm input",function(d){var c=d.keyCode||d.which;if(c=="13"){if(Aero.model.guide.validate()){b.save()}return false}});$q("body").off("click.aeroGSave").on("click.aeroGSave",".aero-editing-guide .aero-btn-save",function(){if(Aero.model.guide.validate()){b.save();return false}});$q("body").off("click.apA").on("click.apA",".aero-pathways-search a",function(){var c=$q(".aero-pathways").val();if(c!=""){Aero.pathways.createMapping(c,Aero.view.admin.guideid)}return false});$q("body").off("click.dpA").on("click.dpA",".aero-pathways-list a",function(){var c=$q(this).parent().data("id");Aero.confirm({ok:"unlink",title:"Removing pathway link",msg:"Are you sure you want to remove this pathway?",onConfirm:function(){Aero.pathways.destroyMapping(c,Aero.view.admin.guideid)}});return false});$q("body").off("click.arA").on("click.arA",".aero-roles-search a",function(){var c=$q(".aero-roles").val();if(c!=""){Aero.roles.createMapping(c,Aero.view.admin.guideid)}return false});$q("body").off("click.arcs").on("click.arcs",".aero-section input[name='aero_isRestrict']",function(){$q(".aero-color-wrapper").hide();if($q(this).is(":checked")){$q(".aero-color-wrapper").show()}});$q("body").off("click.drA").on("click.drA",".aero-roles-list a",function(){var c=$q(this).parent().data("id");Aero.confirm({ok:"unlink",title:"Removing role link",msg:"Are you sure you want to remove this role?",onConfirm:function(){Aero.roles.destroyMapping(c,Aero.view.admin.guideid)}});return false})}};"use strict";Aero.view.step.admin={addNav:function(){$q(".aero-nav-item:first").clone().append('<a class="aero-del-nav">X</a>').insertAfter(".aero-nav-item:last")},destroyNav:function(a){if($q(".aero-nav-item")){a.parents(".aero-nav-item").remove()}},save:function(){var a=parseInt($q(".aero-step-index").val());var b=$q("#editStepFrm").aeroSerialize();b.id=Aero.view.admin.guideid;b.body=$q("#aeroEditor").trumbowyg("html");b.nav={};if(b.size_custom!=""&&!isNaN(b.size_custom+"")){b.size=b.size_custom+""}delete b.size_custom;var c=Aero.view.step.admin.quiz.collectAnswers();b.answers=(c.length>0)?c:null;$q(".aero_nav_when").each(function(){if($q(this).val()!=""){b.nav[$q(this).val()]=$q(this).parent().find(".aero_nav_to").val()}});if(b.nav.length==0){delete b.nav}if(b.hide){b[b.hide]=true;delete b.hide}b.showTitle=(b.showTitle=="1")?true:null;b.sidebar=(b.sidebar=="1")?true:null;b.multi=(b.multi=="1")?true:null;b.isRestrict=(b.isRestrict=="1")?true:null;b=_q.pick(b,_q.identity);if($q(".aero-editing-step").hasClass("aero-add-step")){Aero.step.add(b);$q(".aero-helper").remove()}else{Aero.step.update(a,b)}Aero.view.admin.close()},initPicker:function(){Aero.picker.init({onStart:function(){Aero.tip.hide();Aero.view.sidebar.hide()},callback:function(l){Aero.view.sidebar.show(false,0);Aero.picker.destroy();var h=(Aero.tip._guide.step.length>0)?Aero.tip._current+1:0;var a=[];var j="";var f="";var k="";var m=$q(l).prop("tagName").toLowerCase();var e=["button","a"];if($q.inArray(m,e)>-1){k=$q.trim($q(l).text());f="Click "+k;j=k;a={click:"-1"}}e=["input","select","textarea"];if($q.inArray(m,e)>-1){k=$q.trim($q(l).parent().find("label:eq(0)").text());var i=$q("label[for='"+$q(l).attr("id")+"']");if(i.length>0){k=i.text().replace("*","")}f="Enter "+k;j=k;a={blur:"-1"}}var b=document.URL;var g=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");b=b.replace(g,"");if(!b.match(/#\/$/)){var d=/(\/$|\/#$|#$)/;b=b.replace(d,"")}var c={id:null,title:j,body:f,url:b,isAdd:true,index:h,loc:l,nav:a};Aero.view.admin.render("step",$q.extend(Aero.model.step.defaults(),c))}});Aero.picker.setEvents()},renderSortable:function(){$q(".aero-steps ul").sortable({placeholder:"aero-helper-dropable",update:function(a,b){Aero.step.moveIndex(Aero.moveFrom,b.item.index());Aero.moveFrom=null},start:function(a,b){Aero.moveFrom=b.item.index()}}).disableSelection()},setEvents:function(){var a=this;$q("body").off("click.aroSD").on("click.aroSD",".aero-steps ul li a.aero-delete",function(){var b=$q(".aero-steps li").index($q(this).parents("li:eq(0)"));Aero.confirm({ok:"Delete",title:"Step delete",msg:"Are you sure you want to delete this step?",onConfirm:function(){Aero.step.destroy(b)}});return false});$q("body").off("click.aeroSEdit").on("click.aeroSEdit",".aero-steps ul li a.aero-edit",function(){var b=$q(this).parents("li:eq(0)");Aero.index=$q(".aero-steps li").index(b);Aero.view.admin.edit($q(this));return false});$q("body").off("keypress.ssa").on("keypress.ssa","#editStepFrm input:not(.aero-input-label)",function(c){var b=c.keyCode||c.which;if(b=="13"){if(Aero.model.step.validate()){a.save()}return false}});$q("body").off("click.aeroSSave").on("click.aeroSSave",".aero-editing-step .aero-btn-save",function(){if(Aero.model.step.validate()){a.save();return false}});$q("body").off("click.aeroTab").on("click.aeroTab",".aero-tab a",function(){var b="aero-tab-active";var c=$q(this).parents(".aero-section");c.find("."+b).removeClass(b);c.find($q(this).attr("href")).addClass(b);$q(this).addClass(b);if($q(this).attr("id")=="aero-section-quiz"){Aero.view.step.admin.quiz.render()}return false});$q("body").off("click.aeroNAdd").on("click.aeroNAdd",".aero-editing-step .aero-add-nav",function(){a.addNav();return false});$q("body").off("click.aeroNDel").on("click.aeroNDel",".aero-editing-step .aero-del-nav",function(){a.destroyNav($q(this));return false});$q("body").off("change.ssC").on("change.ssC",".aero-section select[name='aero_size']",function(){$q(".aero-custom-size").hide();$q(".aero-custom-size input").val("");if($q(this).val()=="custom"){$q(".aero-custom-size").show()}});$q("body").off("change.seC").on("change.seC",".aero-section select[name='aero_miss']",function(){$q(".aero-alert-edit").hide();$q(".aero_alert, .aero_alertContent").val("");if($q(this).val()=="alert"){$q(".aero-alert-edit").show()}});$q("body").on("mouseup","a.aero-btn-picker",function(){a.initPicker()}).on("click","a.aero-btn-picker",function(){return false})}};"use strict";Aero.pathways={getAll:function(a){if(!Aero.constants.PATHWAYS){Aero.send("api/pathway",{},function(b){Aero.constants.PATHWAYS=b;a(b)},"GET")}else{a(Aero.constants.PATHWAYS)}},getByGuideid:function(a,b){Aero.send("api/pathwaymap/by_guide",{guideid:a},function(c){b(c)},"GET")},createMapping:function(b,a){Aero.send("api/pathwaymap",{guideid:a,pathwayid:b},function(){Aero.view.guide.admin.renderMapping("pathways")},"POST")},destroyMapping:function(b,a){Aero.send("api/pathwaymap",{guideid:a,pathwayid:b},function(){Aero.view.guide.admin.renderMapping("pathways")},"DELETE")}};"use strict";Aero.roles={getAll:function(a){if(!Aero.constants.ROLES){Aero.send("api/role",{},function(b){Aero.constants.ROLES=b;a(b)},"GET")}else{a(Aero.constants.ROLES)}},getByGuideid:function(a,b){Aero.send("api/rolemap/by_guide",{guideid:a},function(c){b(c)},"GET")},createMapping:function(a,b){Aero.send("api/rolemap",{guideid:b,roleid:a},function(){Aero.view.guide.admin.renderMapping("roles")},"POST")},destroyMapping:function(a,b){Aero.send("api/rolemap",{guideid:b,roleid:a},function(){Aero.view.guide.admin.renderMapping("roles")},"DELETE")}};"use strict";Aero.picker={options:{onStart:function(){Aero.log("Starting picker","info")},callback:function(a){Aero.log("Starting picker path:"+a,"info")}},init:function(b){var a=this;var d=$q(".aero-picker");var c=$q.extend({},this.options,b);c.onStart();if(d.length==0){d=$q('<div class="aero-picker" style="border:0.2em dashed #0599c3; position: fixed; top: 0; left: 0; height: 100%; width: 100%; z-index:999999999999;"></div>');$q("body").append(d);d.on("mousemove.aeroPicker",function(f){a.latch(f)}).on("mouseup.aeroPicker",function(f){c.callback(a.get(f))})}},destroy:function(){$q(".aero-picker").remove();$q("*").off(".aeroPicker")},latch:function(l){var o=this;var p=this.getElementByPos(l.pageX,l.pageY);if(p.length>0){var a=false;var d=$q(".aero-picker");var h=this.scrollOffset(p);var m=h.top;var f=h.left;var n=p.outerHeight();var c=p.outerWidth();if(p.prop("tagName")=="IFRAME"){a=true;var g=p.get(0);var j=p.contentWindow?g.contentWindow:g.contentDocument.defaultView;var b=$q(j.document.elementFromPoint(l.pageX-f,l.pageY-m));var k=b.offset()}p.trigger("mouseover");p.trigger("mouseenter");if(a){m=m+k.top;f=f+k.left;n=b.outerHeight();c=b.outerWidth()}if(n>0&&c>0){d.css({height:n+"px",width:c+"px",top:m+"px",left:f+"px"})}}},get:function(c){var a=this;var b=a.getElementByPos(c.pageX,c.pageY);return b.getSelector()[0]},getElementByPos:function(a,c){$q(".aero-picker").hide();a-=$q(document).scrollLeft();c-=$q(document).scrollTop();var b=document.elementFromPoint(a,c);$q(".aero-picker").show();return $q(b)},scrollOffset:function(a){var b=a.offset();b.top-=$q(document).scrollTop();b.left-=$q(document).scrollLeft();return b},setEvents:function(){var a=this;$q("body").on("mousemove.aeroPicker","*",function(b){a.latch(b)});$q(document).keyup(function(b){if(b.keyCode==27){a.destroy();Aero.view.sidebar.show(false,0)}})}};"use strict";Aero.view.step.admin.quiz={render:function(){this.setEvents()},renderAnswer:function(e,b){if(e.title!=""){var d=e.correct?"aero-checked":"";var a=e.correct?"fa-check-square-o":"fa-square-o";var c='<li class="clearfix"><a class="aero-btn-grey aero-answer-delete"><i class="fa fa-times"></i></a><a class="aero-btn-grey aero-answer-check '+d+'"><i class="fa '+a+'"></i></a><span>'+e.title+"</span></li>";if(!b){$q(".aero-answer-list ul").append($q(c));$q(".aero-answer").val("")}else{return c}}},collectAnswers:function(){var a=[];$q(".aero-answer-list li").each(function(){var b={title:$q(this).find("span").text(),correct:$q(this).find(".aero-answer-check").hasClass("aero-checked")};a.push(b);console.log($q(this).find(".aero-answer-check"))});console.log(a);return a},setEvents:function(){var a=this;$q(".aero-answer-list ul").sortable();$q("body").off("click.qaa").on("click.qaa",".aero-answer-add",function(){var b={title:$q(this).val(),correct:false};a.renderAnswer(b)});$q("body").off("click.qaa").on("click.qaa",".aero-answer-check",function(){var b=$q(this).find("i");if(b.hasClass("fa-square-o")){$q(this).addClass("aero-checked");b.attr("class",b.attr("class").replace("-square","-check-square"))}else{$q(this).removeClass("aero-checked");b.attr("class",b.attr("class").replace("-check-square","-square"))}});$q("body").off("keydown.qkp").on("keydown.qkp",".aero-answer",function(d){var b=(d.keyCode?d.keyCode:d.which);if(b=="13"){var c={title:$q(this).val(),correct:false};a.renderAnswer(c);return false}});$q("body").off("click.qd").on("click.qd",".aero-answer-delete",function(b){$q(this).parents("li:eq(0)").remove()})}};"use strict";function AeroAdminMain(){if(AeroStep.admin){Aero.view.admin.setEvents("step");Aero.view.admin.setEvents("guide");Aero.view.step.admin.setEvents();Aero.view.guide.admin.setEvents()}$q(document).keyup(function(a){if(a.keyCode==192){Aero.view.step.admin.pickerStart()}})}AeroAdminMain();