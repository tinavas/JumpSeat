"use strict";Aero.tip={tries:0,options:{labels:{end:AeroStep.lang.finished,next:AeroStep.lang.next,prev:AeroStep.lang.prev},template:function(f){var n="",m="",b="",e="";var k=f.position?f.position:"top";var c=parseInt(Aero.tip._current)+1;var l=(Aero.tip._guide)?Aero.tip._guide.step.length:0;if(isNaN(f.size)){n=(f.size&&f.size!="")?" aero-tip-"+f.size:""}else{n="' style='width:"+f.size+"px'"}var h=["OVERVIEW","CLICK","CHOOSE","COPY","DRAG","FORK","NOTE","TIP","TYPE","SCROLL"];var d='<img class="as-icon-TITLE" src="'+Aero.constants.PATH+'assets/images/icons/TITLE.png" title="TITLE" />';for(var g in h){if(typeof h[g]=="string"){var m=(h[g]=="OVERVIEW")?"Overview":"";f.title=f.title.replace(h[g],d.replace(/TITLE/g,h[g].toLowerCase())+" "+m)}}if(f.showTitle){m='<div class="aero-tip-title">'+f.title+"<span></span></div>"}var a=f.multi?"":"<div class='aero-tip-nav clearfix'><div class='aero-progress'><span>Step "+c+" of "+l+"</span></div></div>";if(!Aero.tip._guide){a=""}if(f.answers&&f.answers.length>0){b=Aero.view.quiz.render(f.answers,f.quizsize)}if(f.embed||f.youtube){e=Aero.view.media.render(f)}return"<div id='"+f.id+"' class='aero-tip aero-tip-"+k+n+"' style='display:none'><div class='aero-tip-arrow'></div><div class='aero-tip-body'>"+m+f.body+b+e+"</div>"+a+"<div class='aero-tip-draggable'></div></div>"}},spotlight:function(g,e){return;var b,d,f,a,c;b=$q(e.loc);b.addClass("ae-showElement ae-relativePosition");f=b.outerWidth()+10;a=b.outerHeight()+10;c=b.offset();d=$q('<div class="aero-remove ae-overlay" style="top: 0;bottom: 0; left: 0;right: 0;position: fixed;opacity: 0.8;"></div>');$q("body").append(d);d=$q("<div />").addClass("aero-remove ae-helperLayer").css({width:f,height:a,top:c.top-5,left:c.left-5});$q("body").append(d)},setGuide:function(d,c,b){var a=this;a._guide=false;aeroStorage.getItem("aero:session",function(e){if(e&&!b){a._guide=JSON.parse(e);Aero.view.step.render(a._guide);if(c){c()}}else{Aero.model.guide.byId(d,function(f){a._guide=f;Aero.view.step.render(a._guide);aeroStorage.setItem("aero:session",JSON.stringify(a._guide),function(){if(c){c()}},true)})}},true)},setStep:function(a,b,c){this._current=parseInt(a);if(!b){aeroStorage.setItem("aero:session:current",this._current,function(){if(c){c()}},true)}else{if(c){c()}}},redirect:function(a,k,l){var n=this;var d=false;var e=/#$/;var c=/\/$/;var j=document.URL;var h=false;var b=(h||aeroStorage.override)?Aero.host:location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");var g=l?l:b;if(a=="/#/"){d=true}if(!a){a=""}a=g+a;if(!d){if(e.test(j)){j=j.replace("#","")}if(c.test(j)){j=j.slice(0,-1)}}a=AeroStep.getSubURL(a);if(k=="all"){return false}if(k=="par"){j=j.split("?")[0];a=a.split("?")[0]}if(k=="anc"){j=j.split("#")[0];a=a.split("#")[0]}if(j!=a){var f=aeroStorage.getItem("aero:session:404");var m=(f)?(parseInt(f)+1):0;aeroStorage.setItem("aero:session:404",m);if(m>1){Aero.confirm({ok:AeroStep.lang.done,title:AeroStep.lang.notfound,msg:AeroStep.lang.urlloop+"</br></br><strong>"+a+"</strong>",onConfirm:function(){Aero.tip.stop()},onClose:function(){Aero.view.step.setState(aeroStorage.getItem("aero:session:pause"),"forward")}})}else{if(Aero.forceTakeme||Aero.navigating||Aero.tip._current==0){Aero.navigating=false;window.location=a;return true}Aero.confirm({ok:AeroStep.lang.oopst,cancel:AeroStep.lang.oopsm,title:AeroStep.lang.oops,msg:AeroStep.lang.oopsdesc,onConfirm:function(){window.location=a},onCancel:function(){Aero.forceTakeme=true;var o=Aero.tip._current-1;n.setStep(o,false,function(){Aero.tip.jumpTo(o)})},onClose:function(){Aero.view.step.setState(aeroStorage.getItem("aero:session:pause"),"forward")}})}return true}return false},validate:function(){var b=true;var a=Aero.step.get(this._current);if(a.answers&&a.answers.length>0){b=Aero.view.quiz.validate(a)}return b},start:function(e,c,d){var b=c?c:0;var a=this;window.postMessage({type:"cloudninjas-track-start"},"*");aeroStorage.getItem("aero:session:cds",function(f){if(!f){aeroStorage.setItem("aero:session:cds",Aero.host,function(){},true)}else{Aero.host=f}a._forward=true;a.setGuide(e,function(){Aero.audit.init(function(){a.setNav();$q(".aero-restrict").remove();a.beforeShow(b)})},d)},true)},stop:function(){var a=this;if(!a.validate()){return}aeroStorage.getItem("aero:session:cds",function(c){if(c){Aero.host=AeroStep.host;aeroStorage.removeItem("aero:sidebar:cdshost",true);aeroStorage.removeItem("aero:session:cds",true);aeroStorage.removeItem("aero:guides",null);aeroStorage.removeItem("aero:cache",null)}$q(".aero-play-icon").remove();aeroStorage.setItem("aero:cache",-1);var b=a.isReturnBranch();if(!b){if(Aero.tip._guide.step&&Aero.tip._current==(Aero.tip._guide.step.length-1)){a.sayCongrats()}else{window.postMessage({type:"cloudninjas-track-incomplete"},"*")}a.setStep(null);a.hide(a._current);clearInterval(a.ob);Aero.tip._guide=null;AeroStep.session.destroy();Aero.guide.init()}},true)},next:function(){if(!this.validate()){return}if(aeroStorage.getItem("aero:session:end")=="1"){if(!AeroStep.admin){self.stop()}return}var a=Aero.step.get(this._current);this._forward=true;clearInterval(this.ob);aeroStorage.removeItem("aero:session:pause");if(a.next!=-1){this.hide(this._current);this.beforeShow(a.next)}},prev:function(){var a=Aero.step.get(this._current);this._forward=false;clearInterval(this.ob);aeroStorage.removeItem("aero:session:pause");if(a.prev!=-1){this.hide(this._current);this.beforeShow(a.prev)}},jumpTo:function(a){if(aeroStorage.getItem("aero:session:end")=="1"){if(!AeroStep.admin){self.stop()}else{aeroStorage.removeItem("aero:session:end")}}var b=Aero.step.get(a);this._forward=true;clearInterval(this.ob);Aero.jump=true;$q(".aero-play-icon").remove();aeroStorage.removeItem("aero:session:pause");if(b){this.hide(this._current);this.beforeShow(a)}},findStep:function(b){var a=false;if(b.position=="orphan"){b.loc="body"}if(b.loc){a=b.isFrame?$q(b.framePath).contents().find(b.loc):$q(b.loc);if(a.length===0||!a.is(":visible")||a.css("visibility")=="hidden"){a=false}}return a},findStepTimeout:function(type,step,time,i){var self=this;if(Aero.hashChange){return}clearTimeout(Aero.timeFindStep);if($q(".aero-modal:visible").length>0){return}if(self.tries<time*2){Aero.timeFindStep=setTimeout(function(){self.hide(i-1);var before=(self._forward)?step.beforeCode:self._guide.step[i].beforeCode;if(before){try{eval(before)}catch(err){Aero.log("Before show code is broken: "+err,"error")}}self.show(i);self.tries++},500)}else{Aero.view.step.setState(i,"missing");var prefix=type=="loss"?"loss":"";if(step[type]=="alert"){this.renderException(step[prefix+"alert"],step[prefix+"alertContent"],true)}else{if(step[type]=="back"){Aero.view.step.setState(i,"missing");this.prev()}else{if(step[type]=="skip"){self.show(i+1)}else{if(step[type]=="skipto"){self.jumpTo(step[prefix+"skipto"]);for(var i=Aero.tip._current;i<=step[prefix+"skipto"]-1;i++){Aero.view.step.setState(i,"missing")}}else{if(step[type]=="ignore"){return}else{this.renderException("Step is Missing","To fix this, try:<ul style='font-size:14px'><li>Using a more generic element</li><li>Increase the step wait timer</li><li>Check the previous step navigation:<ul><li>Page changed or refreshed - when steps move between pages</li><li>Next item visible - on the same page, but has an animation or time delay when showing the next step</li></ul></li></ul>",true)}}}}}}},observe:function(b,d,e){var a=this;var c=Aero.step.get(b);if(d){clearInterval(a.obf);a.obf=setInterval(function(){var f=a.findStep(c);Aero.navigating=true;Aero.log("Observing for item visible","info");if(f){Aero.log("Observe found item","success");clearInterval(a.obf);e()}},500)}else{clearInterval(a.ob);a.ob=setInterval(function(){Aero.log("Observing for item not visible","info");var f=a.findStep(c);if(!f){setTimeout(function(){if(Aero.navigating){Aero.navigating=false;clearInterval(a.ob);return}Aero.log("Observe lost item","warn");e();clearInterval(a.ob)},500)}},1000)}},beforeShow:function(i){var self=this;self.tries=1;var step=Aero.step.get(i);self.setStep(i,false,function(){var wait=200;var before=(self._forward)?step.beforeCode:self._guide.step[i].beforeCode;if(step.pause){wait=parseInt(step.pause)*1000}if(before){try{eval(before)}catch(err){Aero.log("Before show code is broken: "+err,"error")}}clearTimeout(Aero.timeBeforeShow);Aero.timeBeforeShow=setTimeout(function(){if(!Aero.hashChange){self.show(i)}},wait)})},show:function(c,f){var e,b,d,a;a=this;clearTimeout(Aero.timeFindStep);if(Aero.tip._guide.step.length==0){return}if(typeof c=="undefined"){c=a._current}if(!Aero.tip._guide||c>Aero.tip._guide.step.length||c<0){return}aeroStorage.setItem("aero:session:forward",true);d=Aero.step.get(c);aeroStorage.setItem("aero:sidebar:open",d.sidebar?0:1,function(){},true);a.setStep(c,f,function(){if(d.sidebar){setTimeout("Aero.view.sidebar.hide();",100)}else{aeroStorage.getItem("aero:sidebar:open",function(k){if(!$q(".aero-sidebar").hasClass("open")&&k=="1"){Aero.view.sidebar.show()}},true)}b=a.findStep(d,c);if(AeroStep.admin&&aeroStorage.getItem("aero:session:pause")&&aeroStorage.getItem("aero:session:forwardUrl")!==document.URL){Aero.view.step.setState(aeroStorage.getItem("aero:session:pause"),"forward");var g=$q('<a class="aero-play-icon"><span></span></a>');g.css({top:$q(window).height()/2-150,left:$q(window).width()/2-100});$q("body").append(g);return}else{if(a.redirect(d.url,d.noUrl,d.cds)){return}}aeroStorage.removeItem("aero:session:404");if(b&&b.is(":visible")){Aero.log("Found Step "+c,"success");Aero.navigating=false;Aero.tip.isMoving=null;a.observe(c,false,function(){a.findStepTimeout("loss",d,0,c)});if(d.mask&&d.mask!=""){b.mask(d.mask)}Aero.audit.update();if(AeroStep.admin){aeroStorage.setItem("aero:sidebar:cdshost",c+"~"+window.location.host,function(){},true);aeroStorage.setItem("aero:session:pause",c);aeroStorage.setItem("aero:session:forwardUrl",document.URL)}e=$q(a.options.template(d));if(d.branch){e=a.renderBranch(e,d.branch,d.branchstep,d["return"])}e=a.buildNav(e,d);$q(".ae-active-el").removeClass("ae-active-el");b.addClass("ae-active-el");$q("body").append(e);Aero.view.step.setState(c);a.setPosition(b,e,d.position);a.setEvents(b,d.nav,e,d.position);if(d.position!="orphan"){a.scrollToElement(b)}else{$q(".aero-tip").fadeIn(200)}}else{if(d.tries&&d.tries>0){a.findStepTimeout("miss",d,d.tries,c);return}else{if(!d.multi){clearTimeout(Aero.timeFindStep);Aero.log("Skipping step: "+c+" with loc:"+d.loc,"error");Aero.view.step.setState(c,"missing");if(c<Aero.tip._guide.step.length){if(a._forward){a.next()}else{a.prev()}}}}}var h=(a._forward)?1:-1;var j=false;if(a._forward&&Aero.step.get(c+h).multi||!a._forward&&d.multi){j=true}if(Aero.jump&&d.multi){j=true;h=-1;a._forward=false}if(j){a.show(c+h,true)}Aero.jump=null})},hide:function(i){var step=Aero.step.get(i);if(!$q(".aero-tip:visible").length>0){return}$q(".aero-active, .aero-showElement").removeClass("aero-active aero-showElement aero-relativePosition");$q(".aero-tip, .aero-remove").remove();if(step.afterCode){try{eval(step.afterCode)}catch(err){Aero.log("After hide code is broken: "+err,"error")}}},buildNav:function(b,c){var d="";var a=false;if(!c.nav.next&&!c.nav.blur){a=true}if(c.nav.length==0){a=false}if(!c.noNav){if(c.next==-1){d+="<a class='aero-btn-end'>"+this.options.labels.end+"</a>"}if(!c.noNext&&!a&&c.next!=-1){d+="<a class='aero-btn-next'>"+this.options.labels.next+"</a>"}if(!c.noPrev&&c.prev!=-1){d+="<a class='aero-btn-prev'>"+this.options.labels.prev+"</a>"}}b.find(".aero-tip-nav").append(d);return b},setPosition:function(k,b,c){var h={};var a=k.offset();var e=b.outerWidth()/2;var d=b.outerHeight();var j=a.left+(k.outerWidth()/2);var g=a.top+(k.outerHeight()/2);var f=b.find(".aero-tip-arrow");h.tLeft=e-(f.outerWidth()/2);h.tTop=(b.outerHeight()/2)-(f.outerHeight()/2);switch(c){case"top":h.left=j-e;h.top=a.top-d-b.find(".aero-tip-arrow").outerHeight();break;case"bottom":h.left=j-e;h.top=a.top+k.outerHeight();break;case"left":h.left=a.left-b.outerWidth()-b.find(".aero-tip-arrow").outerWidth();h.top=g-(d/2);break;case"right":h.left=a.left+k.outerWidth();h.top=g-(d/2);break;case"orphan":h.left=$q(window).width()/2-e;h.top=$q(window).height()/2-(d/2);break}h=this.containIn(document,b,h,c);b.css({left:h.left,top:h.top});if(b.hasClass("aero-tip-bottom")||b.hasClass("aero-tip-top")){f.css({left:h.tLeft})}if(b.hasClass("aero-tip-left")||b.hasClass("aero-tip-right")){f.css({top:h.tTop})}if(b.hasClass("aero-tip-top")){f.css({top:"auto"})}},containIn:function(b,f,h,g){var d=$q(b).height();var j=$q(window).width();var e=h.left+f.outerWidth()-j;var c=h.top+f.outerHeight()-d;if(e>0){if(g=="bottom"||g=="top"){h.tLeft+=e}h.left-=e}if(h.left<0){if(g=="bottom"||g=="top"){h.tLeft+=h.left}h.left-=h.left}if(h.top<0){if(g=="left"||g=="right"){h.tTop+=h.top}h.top-=h.top}if(c>0&&g=="bottom"){if(g=="left"||g=="right"){h.tTop+=c}h.top-=c}var a=h.left+f.outerWidth();if(a>(j-270)){aeroStorage.getItem("aero:sidebar:open",function(k){Aero.view.sidebar.hide()},true)}else{aeroStorage.getItem("aero:sidebar:open",function(k){if(k=="1"){Aero.view.sidebar.show()}},true);if(g=="orphan"){h.left-=115}}return h},scrollToElement:function(b){var c=$q(".aero-tip:eq(0)");var d=Aero.pos.isScrollable(b);var a=0;c.show();if(!b.visible(false,d)||!c.visible(false)){a=d?d.scrollTop()-d.offset().top:0;d=d?d:$q("body, html");c.hide();d.stop().animate({scrollTop:a+b.offset().top-(d.height()/2+b.height()/2)},500,function(){$q(".aero-tip").fadeIn(200)});c.hide()}else{c.hide();$q(".aero-tip").fadeIn(200)}},isReturnBranch:function(){var b=aeroStorage.getItem("aero:session:branch:returnid");var a=aeroStorage.getItem("aero:session:branch:returnto");if(!b){return false}aeroStorage.removeItem("aero:session:branch:returnid");aeroStorage.removeItem("aero:session:branch:returnto");Aero.confirm({ok:"Return",cancel:"End Guide",title:"Branch complete",msg:"You have completed this branch, we will now move you back to the original guide.",onConfirm:function(){Aero.tip.hide();Aero.tip.start(b,parseInt(a),true)},onCancel:function(){Aero.tip.stop()}});return true},renderBranch:function(f,c,e,d){var a=f.find(".aero-tip-body").html();var b=a+"<div class='aero-branch'></div>";setTimeout(function(){for(i in c){if(typeof c[i]=="string"){Aero.guide.get(c[i],function(g){if($q(".aero-branch").find("#b-"+g.id).length==0){$q(".aero-branch").append("<a id='b-"+g.id+"' data-returnid='"+Aero.tip._guide.id+"' data-returnto='"+d+"' data-guideid='"+g.id+"' class='aero-start'>"+g.title+"</a>")}$q(window).trigger("resize")})}}},250);f.find(".aero-tip-body").html(b);return f},renderException:function(e,a,b){var f="";if(b&&AeroStep.admin){f='<div class="aero-section aero-goto"><label>Go back to step:</label><select id="aero-goto">';for(var c=0;c<Aero.tip._guide.step.length;c++){var d=c==(Aero.tip._current-1)?'selected="selected"':"";f+="<option "+d+'value="'+c+'">'+(c+1)+": "+Aero.tip._guide.step[c].title+"</option>"}f+="</select></div>"}Aero.confirm({ok:"End Guide",cancel:b?"Go Back":"Ok",title:e,msg:a+f,onConfirm:function(){Aero.tip.stop()},onCancel:function(){if(b&&AeroStep.admin){Aero.tip.jumpTo(parseInt($q("#aero-goto").val()))}else{if(b){Aero.tip.prev()}}},onClose:function(){Aero.view.step.setState(aeroStorage.getItem("aero:session:pause"),"forward")}})},setNav:function(){var a=this;$q("body").off("click.aPe").on("click.aPe",".aero-btn-prev",function(){Aero.navigating=true;a.prev()}).off("click.aEd").on("click.aEd",".aero-btn-end",function(){a.stop()})},sayCongrats:function(){aeroStorage.getItem("aero:session",function(b){var a=JSON.parse(b);if(!AeroStep.admin){try{window.postMessage({type:"cloudninjas-track-completed"},"*")}catch(c){console.log("There was an error sending cloud ninja track completed");console.log(c)}AeroStep.session.destroy()}},true)},setEvents:function(c,e,d,a){var b=this;$q(document).off("scroll.scw").on("scroll.scw"+Aero.tip._current,function(){b.setPosition(c,d,a)},250);$q('div *:not(".aero-steps")').off("scroll.scd").on("scroll.scd"+Aero.tip._current,function(){b.setPosition(c,d,a)},250);$q(".aero-tip").draggable({handle:"div.aero-tip-draggable"});$q(window).on("resize",function(){b.setPosition(c,d,a);Aero.view.sidebar.setScrollable()},250);aeroStorage.removeItem("aero:session:end");if(parseInt($q(".aero-tip:last").attr("id").replace("astep-",""))==(Aero.tip._guide.step.length-1)){aeroStorage.setItem("aero:session:end",1)}$q("body").off("click.branchc").on("click.branchc",".aero-continue",function(){Aero.tip.next()});$q("body").off("click.branchs").on("click.branchs",".aero-start",function(){aeroStorage.setItem("aero:session:branch:returnid",$q(this).data("returnid"));aeroStorage.setItem("aero:session:branch:returnto",$q(this).data("returnto"));Aero.tip.hide();Aero.tip.start($q(this).data("guideid"),0,true)});$q("body").off("click.aNe").on("click.aNe",".aero-btn-next",function(){Aero.navigating=true;b.next()});for(var f in e){if(e.hasOwnProperty(f)){if(e[f]==-1){e[f]=Aero.tip._current+1}e[f]=parseInt(e[f]);switch(f){case"next":$q("body").off("click.aNe").on("click.aNe",".aero-btn-next",function(){Aero.navigating=true;if(!b.validate()){return}b.jumpTo(e[f])});break;case"click":c.off("click.aeronav").on("click.aeronav",c,function(){c.off("click.aeronav");Aero.navigating=true;if(!b.validate()){return}b.jumpTo(e[f])});break;case"rclick":c.off("contextmenu.aeronav").on("contextmenu.aeronav",c,function(){c.off("contextmenu.aeronav");Aero.navigating=true;if(!b.validate()){return}b.jumpTo(e[f])});break;case"mousedown":c.off("mousedown.aeronav").on("mousedown.aeronav",c,function(){Aero.navigating=true;if(!b.validate()){return}b.jumpTo(e[f])});break;case"hover":c.off("mouseenter.aeronav").on("mouseenter.aeronav",c,function(){Aero.navigating=true;if(!b.validate()){return}setTimeout(function(){b.jumpTo(e[f])},500)});break;case"blur":c.off("keydown.aeronav").on("keydown.aeronav",c,function(h){Aero.navigating=true;if(!b.validate()){return}var g=h.keyCode||h.which;if(g==13||g==9){b.jumpTo(e[f])}});c.off("focusout.aeronavb").on("focusout.aeronavb",c,function(g){Aero.navigating=true;if(!b.validate()){return}b.jumpTo(e[f])});break;case"unload":$q(window).off("beforeunload.aeronav").on("beforeunload.aeronav",function(){Aero.navigating=true;b.setStep(e[f])});break;case"observe":b.observe(b._current+1,true,function(){Aero.navigating=true;b.next()});break}}}}};